<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TruthGuard: A Fake News Detection System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.12.0/Recharts.js"></script>
    <style>
        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes scaleIn {
            from {
                transform: scale(0.95);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }
            100% {
                background-position: 1000px 0;
            }
        }
        
        .animate-slide-in {
            animation: slideIn 0.5s ease forwards;
        }
        
        .animate-fade-in {
            animation: fadeIn 0.3s ease forwards;
        }
        
        .animate-scale-in {
            animation: scaleIn 0.4s ease forwards;
        }
        
        .loading-shimmer {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 1000px 100%;
            animation: shimmer 2s infinite linear;
        }
        
        .transcription-container {
            max-height: clamp(200px, 50vh, 400px);
            overflow-y: auto;
            scroll-behavior: smooth;
            transition: all 0.3s ease;
        }
        
        .news-container {
            max-height: clamp(300px, calc(100vh - 4rem), 600px);
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        
        .confidence-chart {
            height: clamp(200px, 40vh, 300px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .form-input {
            transition: all 0.2s ease;
        }
        
        .form-input:focus {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .news-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .news-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        @media (max-width: 640px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .news-container {
                max-height: 300px;
            }
        }
        
        .error-toast {
            animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
        }
        
        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }
        /* Add to your existing CSS */
        
        .analysis-results {
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        .analysis-results>* {
            transition: opacity 0.4s ease, transform 0.4s ease;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .slide-up {
            animation: slideUp 0.5s ease forwards;
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-6 sm:py-8">
        <h1 class="text-2xl sm:text-3xl font-bold text-center mb-6 sm:mb-8">üéôÔ∏èFake news Detection</h1>

        <div class="flex flex-col lg:flex-row gap-4 sm:gap-6">
            <!-- Left Column - Analysis Tool -->
            <div class="w-full lg:w-2/3 space-y-4 sm:space-y-6">
                <!-- Input Form -->
                <div class="bg-white rounded-lg sm:rounded-xl shadow p-4 sm:p-6">
                    <form id="transcriptionForm" class="space-y-4">
                        <div class="form-grid grid gap-4">
                            <div>
                                <label for="videoType" class="block text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                    Content Type
                                </label>
                                <select id="videoType" class="w-full px-3 py-2 text-sm sm:text-base border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="recorded">Recorded Video</option>
                                    <option value="live">Live Stream</option>
                                    <option value="text">Text Analysis</option>
                                    <option value="article">Article URL</option>

                                </select>
                            </div>

                            <div>
                                <label for="language" class="block text-sm font-medium text-gray-700 mb-1 sm:mb-2">
                                    Language
                                </label>
                                <select id="language" class="w-full px-3 py-2 text-sm sm:text-base border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="en">English</option>
                                    <option value="es">Spanish</option>
                                    <option value="fr">French</option>
                                    <option value="de">German</option>
                                    <option value="it">Italian</option>
                                </select>
                            </div>
                        </div>

                        <div id="urlContainer" class="space-y-1 sm:space-y-2">
                            <label for="videoUrl" class="block text-sm font-medium text-gray-700">
                                Video URL
                            </label>
                            <input type="text" id="videoUrl" placeholder="Enter video URL" class="w-full px-3 py-2 text-sm sm:text-base border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        </div>

                        <div id="textContainer" class="hidden space-y-1 sm:space-y-2">
                            <label for="textInput" class="block text-sm font-medium text-gray-700">
                                Text for Analysis
                            </label>
                            <textarea id="textInput" placeholder="Enter or paste text for analysis..." rows="4" class="w-full px-3 py-2 text-sm sm:text-base border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"></textarea>
                        </div>
                        <!-- Add new container for article URL input -->
                        <div id="articleContainer" class="hidden space-y-1 sm:space-y-2">
                            <label for="articleUrl" class="block text-sm font-medium text-gray-700">
                                    Article URL
                                </label>
                            <input type="url" id="articleUrl" placeholder="Enter article URL for analysis" class="w-full px-3 py-2 text-sm sm:text-base border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            <p class="text-xs text-gray-500">Enter the URL of any news article or blog post for analysis</p>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-3">
                            <button type="submit" id="startTranscription" class="w-full bg-blue-600 text-white py-2 sm:py-3 px-4 rounded-md text-sm sm:text-base hover:bg-blue-700 transition duration-300 flex items-center justify-center gap-2">
                                <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                                </svg>
                                <span id="startButtonText">Start Analysis</span>
                            </button>

                            <button type="button" id="stopTranscription" class="w-full bg-red-600 text-white py-2 sm:py-3 px-4 rounded-md text-sm sm:text-base hover:bg-red-700 transition duration-300 hidden flex items-center justify-center gap-2">
                                <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"></path>
                                </svg>
                                Stop
                            </button>
                        </div>
                    </form>

                    <div id="loadingMessage" class="hidden mt-4 text-center text-yellow-600 flex items-center justify-center gap-2">
                        <svg class="animate-spin h-4 w-4 sm:h-5 sm:w-5" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span id="loadingText" class="text-sm sm:text-base">Processing...</span>
                    </div>
                </div>

                <!-- Analysis Results -->
                <div class="bg-white rounded-lg sm:rounded-xl shadow p-4 sm:p-6 ">
                    <h2 class="text-base sm:text-lg font-semibold mb-3 sm:mb-4">Analysis Result:</h2>
                    <div id="transcriptionResult" class="transcription-container bg-gray-50 rounded-md p-3 sm:p-4 mb-4 sm:mb-6 text-sm sm:text-base"></div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
                        <div>
                            <h3 class="text-base sm:text-lg font-semibold mb-2">Fact Check Result:</h3>
                            <div id="factCheckResult" class="bg-gray-50 rounded-md p-3 sm:p-4 text-sm sm:text-base"></div>
                        </div>
                        <div>
                            <h3 class="text-base sm:text-lg font-semibold mb-2">Confidence Analysis:</h3>
                            <div id="confidenceChart" class="confidence-chart bg-gray-50 rounded-md"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column - Trending News -->
            <div class="w-full lg:w-1/3">
                <div class="bg-white rounded-lg sm:rounded-xl shadow p-4 sm:p-6 lg:sticky lg:top-4">
                    <div class="flex justify-between items-center mb-3 sm:mb-4">
                        <h2 class="text-lg sm:text-xl font-bold">Trending News</h2>
                        <button id="refreshNews" class="bg-blue-500 text-white px-3 py-1.5 sm:px-4 sm:py-2 rounded-md text-sm sm:text-base hover:bg-blue-600 transition duration-300 flex items-center gap-2">
                            <svg class="w-3 h-3 sm:w-4 sm:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                            Refresh
                        </button>
                    </div>
                    <div id="trendingNews" class="space-y-3 sm:space-y-4 news-container"></div>
                </div>
            </div>
        </div>
    </div>
    <script src="/script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- <script>

document.addEventListener("DOMContentLoaded", () => {
    const videoTypeSelect = document.getElementById("videoType");
    const urlContainer = document.getElementById("urlContainer");
    const textContainer = document.getElementById("textContainer");
    const articleContainer = document.getElementById("articleContainer");
    const startTranscriptionBtn = document.getElementById("startTranscription");
    const stopTranscriptionBtn = document.getElementById("stopTranscription");
    const loadingMessage = document.getElementById("loadingMessage");
    const startButtonText = document.getElementById("startButtonText");

    // Toggle visibility of input fields based on selected content type
    videoTypeSelect.addEventListener("change", (e) => {
        const selectedType = e.target.value;
        urlContainer.classList.add("hidden");
        textContainer.classList.add("hidden");
        articleContainer.classList.add("hidden");

        if (selectedType === "recorded" || selectedType === "live") {
            urlContainer.classList.remove("hidden");
        } else if (selectedType === "text") {
            textContainer.classList.remove("hidden");
        } else if (selectedType === "article") {
            articleContainer.classList.remove("hidden");
        }
    });

    // Handle form submission for analysis
    startTranscriptionBtn.addEventListener("click", (e) => {
        e.preventDefault();

        // Show loading message
        loadingMessage.classList.remove("hidden");

        // Disable start button and enable stop button
        startTranscriptionBtn.classList.add("hidden");
        stopTranscriptionBtn.classList.remove("hidden");

        const selectedType = videoTypeSelect.value;

        if (selectedType === "recorded" || selectedType === "live") {
            const videoUrl = document.getElementById("videoUrl").value;
            if (!videoUrl) {
                alert("Please provide a valid video URL.");
                resetUI();
                return;
            }
            console.log("Analyzing video:", videoUrl);
        } else if (selectedType === "text") {
            const textInput = document.getElementById("textInput").value.trim();
            if (!textInput) {
                alert("Please provide text for analysis.");
                resetUI();
                return;
            }
            console.log("Analyzing text:", textInput);
        } else if (selectedType === "article") {
            const articleUrl = document.getElementById("articleUrl").value.trim();
            if (!articleUrl) {
                alert("Please provide a valid article URL.");
                resetUI();
                return;
            }
            console.log("Analyzing article URL:", articleUrl);
        }

        // Simulate processing delay
        setTimeout(() => {
            console.log("Analysis complete!");
            alert("Analysis completed successfully!");
            resetUI();
        }, 3000); // 3 seconds delay for demo
    });

    // Handle stop action
    stopTranscriptionBtn.addEventListener("click", (e) => {
        e.preventDefault();
        console.log("Analysis stopped by the user.");
        resetUI();
    });

    // Reset UI elements to their initial state
    function resetUI() {
        loadingMessage.classList.add("hidden");
        stopTranscriptionBtn.classList.add("hidden");
        startTranscriptionBtn.classList.remove("hidden");
    }
});

    </script> -->
</body>

</html>

<script>
    // server side  Configuration
    const CONFIG = {
        WS_URL: 'ws://localhost:3000',
        API_URL: 'http://localhost:3000',
        MAX_RECONNECT_ATTEMPTS: 5,
        RECONNECT_DELAY: 2000,
        ERROR_DISPLAY_DURATION: 5000
    };

    // DOM Elements Management
    const elements = (() => {
        const get = (id) => document.getElementById(id);

        return {
            form: get('transcriptionForm'),
            videoType: get('videoType'),
            videoUrl: get('videoUrl'),
            language: get('language'),
            startButton: get('startTranscription'),
            stopButton: get('stopTranscription'),
            loadingMessage: get('loadingMessage'),
            transcriptionResult: get('transcriptionResult'),
            errorMessage: get('errorMessage'),
            statusMessage: get('statusMessage'),
            factCheckResult: get('factCheckResult'),
            trendingNews: get('trendingNews'),
            textInput: get('textInput'),
            articleUrl: get('articleUrl'),
            confidenceChart: get('confidenceChart'),
            refreshNews: get('refreshNews')
        };
    })();


    // State Management
    const state = {
        ws: null,
        isLiveTranscribing: false,
        reconnectAttempts: 0,
        currentChartInstance: null,
        newsEventSource: null
    };

    const UI = {
        showError(message, duration = CONFIG.ERROR_DISPLAY_DURATION) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'fixed bottom-4 right-4 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg text-sm sm:text-base z-50 animate-fade-in';
            errorDiv.textContent = message;
            document.body.appendChild(errorDiv);

            setTimeout(() => {
                errorDiv.classList.add('animate-fade-out');
                setTimeout(() => errorDiv.remove(), 300);
            }, duration);
        },

        showStatus(message, isError = false) {
            const statusDiv = document.createElement('div');
            statusDiv.className = `fixed top-4 right-4 px-4 py-2 rounded-lg shadow-lg text-sm sm:text-base z-50 animate-fade-in ${
            isError ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'
        }`;
            statusDiv.textContent = message;
            document.body.appendChild(statusDiv);

            setTimeout(() => {
                statusDiv.classList.add('animate-fade-out');
                setTimeout(() => statusDiv.remove(), 300);
            }, 3000);
        },

        showLoading(show) {
            elements.loadingMessage.classList.toggle('hidden', !show);
            elements.startButton.disabled = show;
            if (show) {
                elements.startButton.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                elements.startButton.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        },

        updateTranscription(text, append = false) {
            if (append) {
                const newParagraph = document.createElement('p');
                newParagraph.textContent = text;
                newParagraph.className = 'mb-2 p-2 bg-white rounded text-sm sm:text-base';
                elements.transcriptionResult.appendChild(newParagraph);
                elements.transcriptionResult.scrollTop = elements.transcriptionResult.scrollHeight;
            } else {
                elements.transcriptionResult.innerHTML = `<p class="mb-2 p-2 bg-white rounded text-sm sm:text-base">${text}</p>`;
            }
        },

        clearTranscription() {
            elements.transcriptionResult.innerHTML = '';
            elements.factCheckResult.innerHTML = '';
            if (state.currentChartInstance) {
                Plotly.purge(elements.confidenceChart);
                state.currentChartInstance = null;
            }
        },

        updateFactCheck(analysis) {
            if (!analysis) return;

            const {
                confidence,
                prediction,
                detailed_analysis
            } = analysis;

            const getConfidenceClass = (score) => {
                return score > 70 ? 'bg-green-100 text-green-600' :
                    score > 50 ? 'bg-yellow-100 text-yellow-600' :
                    'bg-red-100 text-red-600';
            };

            elements.factCheckResult.innerHTML = `
            <div class="space-y-4">
                <div class="p-4 rounded-lg ${getConfidenceClass(confidence * 100)}">
                    <h3 class="font-bold text-lg mb-2">Content Analysis</h3>
                    <div class="flex flex-col gap-2">
                        <div class="flex justify-between items-center">
                            <span class="font-medium">Credibility Score:</span>
                            <span class="font-bold">${(confidence * 100).toFixed(2)}%</span>
                        </div>
                        <div class="text-sm font-medium">
                            Prediction: ${prediction}
                        </div>
                    </div>
                </div>
                ${detailed_analysis ? this.generateDetailedAnalysis(detailed_analysis) : ''}
            </div>
        `;

            this.createConfidenceChart(confidence);
        },

        generateDetailedAnalysis(detailed_analysis) {
            return `
            <div class="p-4 bg-white rounded-lg shadow-sm">
                <h4 class="font-semibold mb-3">Analysis Details</h4>
                <div class="space-y-3">
                    <div class="text-sm">
                        <p class="font-medium">Facts vs Claims</p>
                        <div class="mt-1 flex justify-between">
                            <span>Factual Statements: ${detailed_analysis.statements.factual.length}</span>
                            <span>Claims: ${detailed_analysis.statements.claims.length}</span>
                        </div>
                    </div>
                    <div class="text-sm">
                        <p class="font-medium">Writing Style</p>
                        <div class="mt-1">
                            <div>Academic Style: ${detailed_analysis.style.academic_style}/10</div>
                            <div>Emotional Language: ${detailed_analysis.style.emotional_language} instances</div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        },

        createConfidenceChart(confidence) {
            if (!elements.confidenceChart) return;

            const data = [{
                type: 'indicator',
                mode: 'gauge+number',
                value: 0, // Start at 0 for animation
                gauge: {
                    axis: {
                        range: [0, 100]
                    },
                    bar: {
                        color: `hsl(${confidence * 1.2}, 70%, 50%)`
                    },
                    bgcolor: 'white',
                    borderwidth: 2,
                    bordercolor: '#ddd',
                    steps: [{
                        range: [0.0, 50],
                        color: '#fee2e2'
                    }, {
                        range: [50, 70],
                        color: '#fef3c7'
                    }, {
                        range: [70, 100],
                        color: '#dcfce7'
                    }],
                    threshold: {
                        line: {
                            color: 'black',
                            width: 4
                        },
                        thickness: 0.75,
                        value: confidence
                    }
                }
            }];

            const layout = {
                width: elements.confidenceChart.offsetWidth,
                height: 250,
                margin: {
                    t: 25,
                    r: 25,
                    l: 25,
                    b: 25
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                font: {
                    size: 12
                },
                transition: {
                    duration: 1000,
                    easing: 'cubic-in-out'
                }
            };

            const config = {
                responsive: true,
                displayModeBar: false
            };

            if (state.currentChartInstance) {
                Plotly.purge(elements.confidenceChart);
            }

            Plotly.newPlot(elements.confidenceChart, data, layout, config)
                .then(() => {
                    // Animate to final value
                    Plotly.animate(elements.confidenceChart, {
                        data: [{
                            value: confidence * 100
                        }],
                        traces: [0],
                        layout: {}
                    }, {
                        transition: {
                            duration: 1000,
                            easing: 'cubic-in-out'
                        },
                        frame: {
                            duration: 1000,
                            redraw: false
                        }
                    });
                    state.currentChartInstance = elements.confidenceChart;
                });
        },

        updateTrendingNews(news) {
            elements.trendingNews.innerHTML = news.map(article => `
            <div class="mb-3 p-3 bg-white rounded-lg shadow-sm border border-gray-200">
                <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start gap-2">
                    <h3 class="text-base font-semibold">${article.title}</h3>
                    <span class="text-xs text-gray-500">
                        ${new Date(article.published).toLocaleDateString()}
                    </span>
                </div>
                <p class="text-sm text-gray-600 mt-2">
                    ${article.description || ''}
                </p>
                <div class="mt-3 flex justify-between items-center">
                    <span class="text-xs font-medium ${
                        article.analysis.confidence > 0.70 ? 'text-green-600' : 
                        article.analysis.confidence > 0.50 ? 'text-yellow-600' : 'text-red-600'
                    }">
                        Credibility: ${article.analysis.confidence*100}%
                    </span>
                    <a href="${article.url}" target="_blank" 
                       class="text-blue-500 hover:underline text-xs">
                        Read more ‚Üí
                    </a>
                </div>
            </div>
        `).join('');
        }
    };



    // WebSocket Management
    const WebSocketManager = {
        setup() {
            if (state.ws) {
                state.ws.close();
            }

            state.ws = new WebSocket(CONFIG.WS_URL);
            this.attachEventListeners();
        },

        attachEventListeners() {
            state.ws.onopen = () => {
                console.log('WebSocket connection established');
                UI.showStatus('Connected to transcription service');
                state.reconnectAttempts = 0;
            };

            state.ws.onmessage = (event) => {
                try {
                    const data = JSON.parse(event.data);
                    this.handleMessage(data);
                } catch (error) {
                    console.error('Error processing WebSocket message:', error);
                    UI.showError('Error processing transcription data');
                }
            };

            state.ws.onerror = (error) => {
                console.error('WebSocket error:', error);
                UI.showError('Connection error. Please try again.');
            };

            state.ws.onclose = () => {
                console.log('WebSocket connection closed');
                this.handleDisconnect();
            };
        },

        handleMessage(data) {
            switch (data.type) {
                case 'transcription':
                    UI.updateTranscription(data.text, true);
                    if (data.analysis) {
                        UI.updateFactCheck(data.analysis);
                    }
                    break;
                case 'status':
                    UI.showStatus(data.message);
                    break;
                case 'error':
                    UI.showError(data.error);
                    break;
            }
        },

        handleDisconnect() {
            if (state.isLiveTranscribing && state.reconnectAttempts < CONFIG.MAX_RECONNECT_ATTEMPTS) {
                state.reconnectAttempts++;
                UI.showStatus(
                    `Connection lost. Attempting to reconnect... (${state.reconnectAttempts}/${CONFIG.MAX_RECONNECT_ATTEMPTS})`,
                    true
                );
                setTimeout(() => this.setup(), CONFIG.RECONNECT_DELAY * state.reconnectAttempts);
            } else if (state.reconnectAttempts >= CONFIG.MAX_RECONNECT_ATTEMPTS) {
                UI.showError('Maximum reconnection attempts reached. Please refresh the page.');
                TranscriptionManager.stopLive();
            }
        }
    };

    // API Functions
    const API = {
        async transcribeRecorded(videoUrl, language) {
            const response = await fetch(`${CONFIG.API_URL}/api/transcribe-recorded`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    video_url: videoUrl,
                    language
                })
            });

            if (!response.ok) {
                throw new Error('Failed to transcribe video');
            }

            return response.json();
        },

        async analyzeArticle(url, language) {
            const response = await fetch(`${CONFIG.API_URL}/api/analyze-article`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    url,
                    language
                })
            });

            if (!response.ok) {
                throw new Error('Failed to analyze article');
            }

            return response.json();
        },

        async analyzeText(text, language) {
            const response = await fetch(`${CONFIG.API_URL}/api/analyze-text`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    text,
                    language
                })
            });

            if (!response.ok) {
                throw new Error('Failed to analyze text');
            }

            return response.json();
        },

        async fetchTrendingNews() {
            const response = await fetch(`${CONFIG.API_URL}/api/trending-news`);
            if (!response.ok) {
                throw new Error('Failed to fetch trending news');
            }
            return response.json();
        },

        setupNewsStream() {
            if (state.newsEventSource) {
                state.newsEventSource.close();
            }

            state.newsEventSource = new EventSource(`${CONFIG.API_URL}/api/news-stream`);

            state.newsEventSource.onmessage = (event) => {
                try {
                    const news = JSON.parse(event.data);
                    UI.updateTrendingNews(news);
                } catch (error) {
                    console.error('Error processing news stream:', error);
                }
            };

            state.newsEventSource.onerror = (error) => {
                console.error('News stream error:', error);
                state.newsEventSource.close();
                setTimeout(() => this.setupNewsStream(), CONFIG.RECONNECT_DELAY);
            };
        }
    };

    // Transcription Management
    const TranscriptionManager = {
        async handleRecorded(videoUrl, language) {
            try {
                const data = await API.transcribeRecorded(videoUrl, language);
                UI.updateTranscription(data.text);
                UI.updateFactCheck(data.analysis);
                UI.showStatus('Transcription completed successfully');
            } catch (error) {
                console.error('Transcription error:', error);
                UI.showError(error.message);
            } finally {
                UI.showLoading(false);
            }
        },

        async handleArticleAnalysis(url, language) {
            try {
                const data = await API.analyzeArticle(url, language);
                UI.updateTranscription(data.text);
                UI.updateFactCheck(data.analysis);
                UI.showStatus('Article analysis completed successfully');
            } catch (error) {
                console.error('Article analysis error:', error);
                UI.showError(error.message);
            } finally {
                UI.showLoading(false);
            }
        },

        async handleTextAnalysis(text, language) {
            try {
                const data = await API.analyzeText(text, language);
                UI.updateTranscription(data.text);
                UI.updateFactCheck(data.analysis);
                UI.showStatus('Text analysis completed successfully');
            } catch (error) {
                console.error('Text analysis error:', error);
                UI.showError(error.message);
            } finally {
                UI.showLoading(false);
            }
        },

        startLive(videoUrl, language) {
            if (!state.ws || state.ws.readyState !== WebSocket.OPEN) {
                WebSocketManager.setup();
            }

            state.isLiveTranscribing = true;
            elements.stopButton.classList.remove('hidden');
            elements.startButton.classList.add('hidden');

            state.ws.send(JSON.stringify({
                type: 'start_live',
                url: videoUrl,
                language
            }));

            UI.showStatus('Live transcription started');
        },

        stopLive() {
            state.isLiveTranscribing = false;
            elements.stopButton.classList.add('hidden');
            elements.startButton.classList.remove('hidden');

            if (state.ws) {
                state.ws.close();
                state.ws = null;
            }

            UI.showStatus('Live transcription stopped');
        }
    };

    // Input validation and helper functions
    const Validators = {
        isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        },

        isValidText(text) {
            return text.trim().length > 0;
        },

        getInputErrorMessage(type) {
            switch (type) {
                case 'text':
                    return 'Please enter text for analysis';
                case 'article':
                    return 'Please enter a valid article URL';
                default:
                    return 'Please enter a valid URL';
            }
        }
    };

    // Event handlers
    const EventHandlers = {
        handleVideoTypeChange(e) {
            const type = e.target.value;
            const urlContainer = document.getElementById('urlContainer');
            const textContainer = document.getElementById('textContainer');
            const articleContainer = document.getElementById('articleContainer');

            // Hide all containers first
            urlContainer.classList.add('hidden');
            textContainer.classList.add('hidden');
            articleContainer.classList.add('hidden');

            // Show the appropriate container based on selection
            if (type === 'text') {
                textContainer.classList.remove('hidden');
            } else if (type === 'article') {
                articleContainer.classList.remove('hidden');
            } else {
                urlContainer.classList.remove('hidden');
            }

            // Update button text
            const startButtonText = document.getElementById('startButtonText');
            startButtonText.textContent =
                type === 'text' ? 'Analyze Text' :
                type === 'article' ? 'Analyze Article' :
                type === 'live' ? 'Start Live Transcription' :
                'Start Analysis';
        },

        async handleFormSubmit(e) {
            e.preventDefault();

            const videoType = elements.videoType.value;
            const language = elements.language.value;
            let input;

            switch (videoType) {
                case 'text':
                    input = elements.textInput.value.trim();
                    if (!Validators.isValidText(input)) {
                        UI.showError(Validators.getInputErrorMessage(videoType));
                        return;
                    }
                    break;
                case 'article':
                    input = elements.articleUrl.value.trim();
                    if (!Validators.isValidUrl(input)) {
                        UI.showError(Validators.getInputErrorMessage(videoType));
                        return;
                    }
                    break;
                default:
                    input = elements.videoUrl.value.trim();
                    if (!Validators.isValidUrl(input)) {
                        UI.showError(Validators.getInputErrorMessage(videoType));
                        return;
                    }
            }

            UI.clearTranscription();
            UI.showLoading(true);

            switch (videoType) {
                case 'recorded':
                    await TranscriptionManager.handleRecorded(input, language);
                    break;
                case 'live':
                    TranscriptionManager.startLive(input, language);
                    break;
                case 'text':
                    await TranscriptionManager.handleTextAnalysis(input, language);
                    break;
                case 'article':
                    await TranscriptionManager.handleArticleAnalysis(input, language);
                    break;
            }
        },

        handleRefreshNews() {
            API.fetchTrendingNews()
                .then(news => UI.updateTrendingNews(news))
                .catch(error => UI.showError('Failed to refresh news'));
        }
    };

    // Initialize the application
    const initializeApp = async() => {
        // Setup WebSocket
        WebSocketManager.setup();

        // Add event listeners
        elements.form.addEventListener('submit', EventHandlers.handleFormSubmit);
        elements.stopButton.addEventListener('click', TranscriptionManager.stopLive);
        elements.videoType.addEventListener('change', EventHandlers.handleVideoTypeChange);
        if (elements.refreshNews) {
            elements.refreshNews.addEventListener('click', EventHandlers.handleRefreshNews);
        }


        // Handle window resize for charts
        window.addEventListener('resize', () => {
            if (state.currentChartInstance) {
                Plotly.relayout(elements.confidenceChart, {
                    width: elements.confidenceChart.offsetWidth
                });
            }
        });

        // Initialize news features
        try {
            const news = await API.fetchTrendingNews();
            UI.updateTrendingNews(news);
            API.setupNewsStream();
        } catch (error) {
            console.error('Error initializing news features:', error);
            UI.showError('Failed to load news content');
        }
    };

    // Start the application when DOM is loaded
    document.addEventListener('DOMContentLoaded', initializeApp);

    // Clean up function for when the page is unloaded
    window.addEventListener('beforeunload', () => {
        if (state.ws) {
            state.ws.close();
        }
        if (state.newsEventSource) {
            state.newsEventSource.close();
        }
    });
</script>